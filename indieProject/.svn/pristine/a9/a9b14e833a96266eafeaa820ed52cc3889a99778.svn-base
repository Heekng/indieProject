/**
 * 
 */
$(document).ready(function(){getAmaReviews();});

function getAmaReviews(page){
	$.ajax({
		url : pageContext + "/amaMovie/AmaMovieReview.ama",
		type : "post",
		data : {"amaNum" : amaNum, "page" : page},
		dataType : "json",
		success : showAmaReviews
	});
}

function showAmaReviews(reviews){
	var textReview = "";
	var textPaging = "";
	var nowPage = "";
	var startPage = "";
	var endPage = "";
	var realEndPage = "";
	var stars = 0;
	if(reviews != null && reviews.length != 0){
		$.each(reviews, function(index, review){
			nowPage = review.nowPage;
			startPage = review.startPage;
			endPage = review.endPage;
			realEndPage = review.realEndPage;
			totalCnt = review.totalCnt;
			starAvg = review.starAvg;
			// 감상평 목록
			textReview += "<tr><td>"+review.memberId+"</td>";
			if(review.stars == 1){
				textReview += "<td>⭐</td>";
			}else if (review.stars == 2){
				textReview += "<td>⭐⭐</td>";
			}else if (review.stars == 3){
				textReview += "<td>⭐⭐⭐</td>";
			}else if (review.stars == 4){
				textReview += "<td>⭐⭐⭐⭐</td>";
			}else if (review.stars == 5){
				textReview += "<td>⭐⭐⭐⭐⭐</td>";
			}
			textReview += "<td>"+review.replyContent+"</td>";
			textReview += "<td>"+review.replyDate+"</td></tr>";
			$("#starAvg").text("⭐ 평균 평점 "+starAvg);
		});
		// 페이징
		if(nowPage > 1){
			textPaging += "<a href='javascript:getAmaReviews("+(nowPage-1)+")'>[이전]</a>";
		}
		for(let i=startPage; i<=endPage; i++){
			if(i == nowPage){
				textPaging += i+"  ";
			}else{
				textPaging += "<a href='javascript:getAmaReviews("+i+")'>"+i+"  </a>";
			}
		}
		if(realEndPage != nowPage){
			textPaging += "<a href='javascript:getAmaReviews("+(nowPage+1)+")'>[다음]</a>";
		}
	}else{
		textReview += "<td colspan='4' align='center'><strong>아직 등록된 감상평이 없습니다.</strong></td>";
	}
	
	$("#reviewTable").html(textReview);
	$("#paging").html(textPaging);
	console.log(stars);
	
}

// 감상평 등록
function insertReview(){
	var star = $("#star option:selected").val();
	var review = $("#review").val();
	if(star == ""){
		alert("별점을 선택해 주십시오.");
		return;
	}
	if(review == ""){
		alert("감상평을 작성해 주십시오.");
		return;
	}
	$.ajax({
		url : pageContext + "/amaMovie/AmaMovieReviewOk.ama",
		type : "post",
		data : {"star" : star, "review" : review, "amaNum" : amaNum},
		dataType : "text",
		success : function(result){
			alert(result);
			$("#star option:eq(0)").attr("selected", "selected");
			$("#review").val("");
			getAmaReviews(1);
		}
	});
}