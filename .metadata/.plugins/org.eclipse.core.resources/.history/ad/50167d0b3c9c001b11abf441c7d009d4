<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AmaMovie">
	<insert id="insertMovie" parameterType="amaMovieVO">
		INSERT INTO AMAMOVIE_TABLE 
		VALUES (AMAMOVIE_SEQ.NEXTVAL, #{amaTitleEng}, #{amaTitleKor}, TO_DATE(#{amaMakeDate},'YYYY.MM.DD'), #{amaMovieLength}, #{amaDirector}, #{genre}, #{rating}, #{link}, #{popcorn}, #{synopsis}, #{theme}, #{memberId}, 0, SYSDATE)
	</insert>
	
	<select id="getMovieNum" parameterType="amaMovieVO" resultType="_int">
		SELECT AMANUM FROM AMAMOVIE_TABLE WHERE AMATITLEENG = #{amaTitleEng} AND AMATITLEKOR = #{amaTitleKor} AND AMAMAKEDATE = #{amaMakeDate}
	</select>
	
	<insert id="insertMaker" parameterType="amaMovieMakerVO">
		INSERT INTO AMAMOVIEMAKER_TABLE VALUES (#{amaNum}, #{makerPosition}, #{makerName})
	</insert>
	
	<insert id="insertActor" parameterType="amaMovieActorVO">
		INSERT INTO AMAMOVIEACTOR_TABLE VALUES (#{amaNum}, #{amaCast}, #{actorName})
	</insert>
	
	<insert id="insertPoster" parameterType="amaMoviePosterVO">
		INSERT INTO AMAPOSTERFILES_TABLE VALUES (#{amaNum}, #{fileName})
	</insert>
	
	<insert id="insertStillCut" parameterType="amaMovieStillCutVO">
		INSERT INTO AMASTILLCUTFILES_TABLE VALUES (${amaNum}, #{fileName})
	</insert>
	<select id="getAmaData" parameterType="_int" resultType="amaMovieVO">
		SELECT * FROM AMAMOVIE_TABLE WHERE AMANUM = #{amaNum}
	</select>
	<select id="getAmaPoster" parameterType="_int" resultType="amaMoviePosterVO">
		SELECT * FROM AMAPOSTERFILES_TABLE WHERE AMANUM = #{amaNum}
	</select>
	<select id="getAmaStillcut" parameterType="_int" resultType="amaMovieStillCutVO">
		SELECT * FROM AMASTILLCUTFILES_TABLE WHERE AMANUM = #{amaNum}
	</select>
	<select id="getAmaMaker" parameterType="_int" resultType="amaMovieMakerVO">
		SELECT * FROM AMAMOVIEMAKER_TABLE WHERE AMANUM = #{amaNum}
	</select>
	<select id="getAmaActor" parameterType="_int" resultType="amaMovieActorVO">
		SELECT * FROM AMAMOVIEACTOR_TABLE WHERE AMANUM = #{amaNum}
	</select>
	<select id="getAmaReviewRe5" parameterType="_int" resultType="amaMovieReviewVO">
		SELECT * FROM (SELECT * FROM AMAREVIEW_TABLE WHERE AMANUM = #{amaNum} ORDER BY REPLYDATE DESC) <![CDATA[WHERE ROWNUM <= 5]]>
	</select>
	<select id="getAmaReview" parameterType="hashmap" resultType="amaMovieReviewVO">
		SELECT * FROM 
			(SELECT ROWNUM R, D.*FROM 
				(SELECT * FROM AMAREVIEW_TABLE WHERE AMANUM = #{amaNum} ORDER BY REPLYDATE DESC) D) B 
		WHERE B.R BETWEEN #{startRow} AND #{endRow}
	</select>
	<select id="getAmaReviewNum" parameterType="_int" resultType="_int">
		SELECT COUNT(*) FROM AMAREVIEW_TABLE WHERE AMANUM = #{amaNum}
	</select>
	<select id="getPopcornSender" parameterType="_int" resultType="popcornVO">
		SELECT * FROM POPCORN_USE_TABLE WHERE AMANUM = #{amaNum}
	</select>
	<select id="getStarAvg" parameterType="_int" resultType="_double">
		SELECT AVG(STARS) FROM AMAREVIEW_TABLE WHERE AMANUM = #{amaNum}
	</select>
	<select id="checkReviewId" parameterType="hashMap" resultType="_int">
		SELECT COUNT(*) FROM AMAREVIEW_TABLE WHERE AMANUM = #{amaNum} AND MEMBERID = #{memberId}
	</select>
	<insert id="insertAmaReview" parameterType="amaMovieReviewVO">
		INSERT INTO AMAREVIEW_TABLE VALUES (#{amaNum}, AMAREPLY_SEQ.NEXTVAL, #{stars}, #{memberId}, #{replyContent}, SYSDATE)
	</insert>
</mapper>