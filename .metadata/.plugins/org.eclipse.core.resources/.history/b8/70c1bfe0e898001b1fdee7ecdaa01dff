/**
 * 
 */

var posterCnt = 1;
var stillCutCnt = 1;
var makerCnt = 1;
var actorCnt = 1;

function step1(){
	$('#step1').show();
	$('#s1').css("color", "#4fc2cd");
	$('#step2').hide();
	$('#s2').css('color', '#616161');
	$('#step3').hide();
	$('#s3').css('color', '#616161');
}

function step2(){
	$('#step1').hide();
	$('#s1').css("color", "#616161");
	$('#step2').show();
	$('#s2').css('color', '#4fc2cd');
	$('#step3').hide();
	$('#s3').css('color', '#616161');
	
}

function step3(){
	$('#step1').hide();
	$('#s1').css("color", "#616161");
	$('#step2').hide();
	$('#s2').css('color', '#616161');
	$('#step3').show();
	$('#s3').css('color', '#4fc2cd');	
}
				
$.datepicker.setDefaults({
    dateFormat: 'yy.mm.dd',
    prevText: '이전 달',
    nextText: '다음 달',
    monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
    monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
    dayNames: ['일', '월', '화', '수', '목', '금', '토'],
    dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
    dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
    showMonthAfterYear: true,
    yearSuffix: ' 년 ',
   	changeYear: true,
   	changeMonth: true
});

$("#datepicker").datepicker();

$(document).ready(function(){
	  //Show contextmenu:
  $("#poster").on("mouseover", function(e){
    //Get window size:
    var winWidth = $(document).width();
    var winHeight = $(document).height();
    //Get pointer position:
    var posX = e.pageX;
    var posY = e.pageY;
    //Get contextmenu size:
    var menuWidth = $("#posterHelp").width();
    var menuHeight = $("#posterHelp").height();
    //Security margin:
    var secMargin = 10;
    //Prevent page overflow:
    if(posX + menuWidth + secMargin >= winWidth
    && posY + menuHeight + secMargin >= winHeight){
      //Case 1: right-bottom overflow:
      posLeft = posX - menuWidth - secMargin + "px";
      posTop = posY - menuHeight - secMargin + "px";
    }
    else if(posX + menuWidth + secMargin >= winWidth){
      //Case 2: right overflow:
      posLeft = posX - menuWidth - secMargin + "px";
      posTop = posY + secMargin + "px";
    }
    else if(posY + menuHeight + secMargin >= winHeight){
      //Case 3: bottom overflow:
      posLeft = posX + secMargin + "px";
      posTop = posY - menuHeight - secMargin + "px";
    }
    else {
      //Case 4: default values:
      posLeft = posX + secMargin + "px";
      posTop = posY + secMargin + "px";
    };
    //Display contextmenu:
    $("#posterHelp").css({
      "left": posLeft,
      "top": posTop
    }).show();
    //Prevent browser default contextmenu.
    return false;
  });
  //Hide contextmenu:
  $("#poster").on("mouseout", function(){
    $("#posterHelp").hide();
  });
});


function posterAddOk(obj){
	$(obj).parent().children(".posterImgView").attr("src", URL.createObjectURL(event.target.files[0]));
	$(obj).parent().children(".posterImgView").css("objectFit", "contain");
	$(obj).parent().children(".posterImgView").css("display", "block");
	$(obj).parent().children(".posterImgSpan").css("display", "none");
	
	posterCnt++;
	var poster = "<div class='col-2 col-3-small poster' style='padding-left:0;'>"
		+"<img class='img posterImgView' style='display:none; width:100%; height:100%;'>"
		+"<span class='image fit posterImgSpan' style='padding-bottom:30%;'>"
		+"<label for='posterImg"+posterCnt+"'>"
		+"<img class='camera' src='"+contextPath+"/images/add.png' alt='영화 포스터' style='width:50px; margin:47% auto auto auto; cursor:pointer;'/>"
		+"</label></span>"
		+"<input id='posterImg"+posterCnt+"' name='posterImg"+posterCnt+"' type='file' onchange='posterAddOk(this)' style='display:none;'></div>";
	
	$(obj).parent().parent().append(poster);
}

function stillCutAddOk(obj){
	$(obj).parent().children(".stillCutImgView").attr("src", URL.createObjectURL(event.target.files[0]));
	$(obj).parent().children(".stillCutImgView").css("objectFit", "contain");
	$(obj).parent().children(".stillCutImgView").css("display", "block");
	$(obj).parent().children(".stillCutImgSpan").css("display", "none");
	
	stillCutCnt++;
	var stillCut = "<div class='col-2 col-3-small poster' style='padding-left:0;'>"
		+"<img class='img stillCutImgView' style='display:none; width:100%; height:100%;'>"
		+"<span class='image fit stillCutImgSpan' style='padding-bottom:30%;'>"
		+"<label for='stillCutImg"+stillCutCnt+"'>"
		+"<img class='camera' src='"+contextPath+"/images/add.png' alt='영화 포스터' style='width:50px; margin:47% auto auto auto; cursor:pointer;'/>"
		+"</label></span>"
		+"<input id='stillCutImg"+stillCutCnt+"' name='stillCutImg"+stillCutCnt+"' type='file' onchange='stillCutAddOk(this)' style='display:none;'></div>";
	
	$(obj).parent().parent().append(stillCut);
}



$(document).on("click", "#addMaker", function(){
	
	
	var newMaker="<div class='row maker'><div class='col-custom col-2-medium col-12-small' style='margin-left: auto;'></div>"+
				"<div style='padding-bottom:0;' class='col-2 col-3-medium col-5-small duty'><input type='text' name='' id='' value='' /></div>"+
				"<div style='padding-bottom:0;' class='col-2 col-3-medium col-5-small makerName'><input type='text' name='' id='' value='' /></div>"+
				"<div class='col-1 col-2-small' style='margin-right: auto; padding:0;'><a class='button alt small' id='deleteMaker' style='width:100%'>삭제</a></div></div>"
	
	$(this).parent().parent().parent().append(newMaker);
});

$(document).on("click", "#deleteMaker", function(){
	$(this).parent().parent().remove();
});

$(document).on("click", "#addActor", function(){
	var newActor="<div class='row actor'><div class='col-custom col-2-medium col-12-small' style='margin-left: auto;'></div>"+
				"<div style='padding-bottom:0;' class='col-2 col-3-medium col-5-small duty'><input type='text' name='' id='' value='' /></div>"+
				"<div style='padding-bottom:0;' class='col-2 col-3-medium col-5-small makerName'><input type='text' name='' id='' value='' /></div>"+
				"<div class='col-1 col-2-small' style='margin-right: auto; padding:0;'><a class='button alt small' id='deleteActor' style='width:100%'>삭제</a></div></div>"
	
	$(this).parent().parent().parent().append(newActor);
});

$(document).on("click", "#deleteActor", function(){
	
	$(this).parent().parent().remove();
});
